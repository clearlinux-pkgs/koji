From b4517eb4127405f820fb71c6067d032b51829f11 Mon Sep 17 00:00:00 2001
From: William Douglas <william.douglas@intel.com>
Date: Fri, 28 Oct 2022 15:37:19 -0700
Subject: [PATCH] Stop use of function removed in python 3.11

---
 hub/kojixmlrpc.py                     | 6 +++---
 tests/test_builder/test_taskparams.py | 2 +-
 www/kojiweb/wsgi_publisher.py         | 4 ++--
 3 files changed, 6 insertions(+), 6 deletions(-)

diff --git a/hub/kojixmlrpc.py b/hub/kojixmlrpc.py
index fc2cd67..3098526 100644
--- a/hub/kojixmlrpc.py
+++ b/hub/kojixmlrpc.py
@@ -117,17 +117,17 @@ class HandlerRegistry(object):
         ret = self.argspec_cache.get(func)
         if ret:
             return ret
-        ret = tuple(inspect.getargspec(func))
+        ret = tuple(inspect.getfullargspec(func))
         if inspect.ismethod(func) and func.__self__:
             # bound method, remove first arg
-            args, varargs, varkw, defaults = ret
+            args, varargs, varkw, defaults, _kwonlyargs, _kwonlydefaults, _annotations = ret
             if args:
                 aname = args[0]  # generally "self"
                 del args[0]
                 if defaults and aname in defaults:
                     # shouldn't happen, but...
                     del defaults[aname]
-        return ret
+        return tuple([args, varargs, varkw, defaults])
 
     def list_api(self):
         funcs = []
diff --git a/tests/test_builder/test_taskparams.py b/tests/test_builder/test_taskparams.py
index 56ee6b2..91f32d4 100644
--- a/tests/test_builder/test_taskparams.py
+++ b/tests/test_builder/test_taskparams.py
@@ -55,7 +55,7 @@ class TestParseTaskParams(unittest.TestCase):
                 spec.args.pop(0)
                 spec = spec[:-3]
             else:
-                spec = inspect.getargspec(h_class.handler)
+                spec = inspect.getfullargspec(h_class.handler)
                 # unbound method, so strip "self"
                 spec.args.pop(0)
 
diff --git a/www/kojiweb/wsgi_publisher.py b/www/kojiweb/wsgi_publisher.py
index 4d46a6b..5dfc235 100644
--- a/www/kojiweb/wsgi_publisher.py
+++ b/www/kojiweb/wsgi_publisher.py
@@ -216,7 +216,7 @@ class Dispatcher(object):
                 if not inspect.isfunction(val):
                     continue
                 # err on the side of paranoia
-                args = inspect.getargspec(val)
+                args = inspect.getfullargspec(val)
                 if not args[0] or args[0][0] != 'environ':
                     continue
             except Exception:
@@ -257,7 +257,7 @@ class Dispatcher(object):
             if isinstance(val, list) and len(val) == 1:
                 data[arg] = val[0]
         environ['koji.form'] = fs
-        args, varargs, varkw, defaults = inspect.getargspec(func)
+        args, varargs, varkw, defaults, _kwonlyargs, _kwonlydefaults, _annotations = inspect.getfullargspec(func)
         if not varkw:
             # remove any unexpected args
             data = dslice(data, args, strict=False)
-- 
2.37.3

