From 55f0893d8d234ea925b3dca640c128fc5211ea24 Mon Sep 17 00:00:00 2001
From: William Douglas <william.douglas@intel.com>
Date: Fri, 28 Oct 2022 15:37:19 -0700
Subject: [PATCH] Stop use of functions removed in python 3.11

---
 hub/kojixmlrpc.py                     | 8 ++++----
 tests/test_builder/test_taskparams.py | 2 +-
 www/kojiweb/wsgi_publisher.py         | 4 ++--
 3 files changed, 7 insertions(+), 7 deletions(-)

diff --git a/hub/kojixmlrpc.py b/hub/kojixmlrpc.py
index fc2cd67..c3340e4 100644
--- a/hub/kojixmlrpc.py
+++ b/hub/kojixmlrpc.py
@@ -117,10 +117,10 @@ class HandlerRegistry(object):
         ret = self.argspec_cache.get(func)
         if ret:
             return ret
-        ret = tuple(inspect.getargspec(func))
+        ret = tuple(inspect.getfullargspec(func))
         if inspect.ismethod(func) and func.__self__:
             # bound method, remove first arg
-            args, varargs, varkw, defaults = ret
+            args, _varargs, _varkw, defaults, _kwonlyargs, _kwonlydefaults, _annotations = ret
             if args:
                 aname = args[0]  # generally "self"
                 del args[0]
@@ -139,7 +139,7 @@ class HandlerRegistry(object):
             funcs.append({'name': name,
                           'doc': func.__doc__,
                           'argspec': argspec,
-                          'argdesc': inspect.formatargspec(*argspec),
+                          'argdesc': format(inspect.signature(func)),
                           'args': args})
         return funcs
 
@@ -167,7 +167,7 @@ class HandlerRegistry(object):
         func = self.funcs.get(method)
         if func is None:
             return ""
-        args = inspect.formatargspec(*self.getargspec(func))
+        args = format(inspect.signature(func))
         ret = '%s%s' % (method, args)
         if func.__doc__:
             ret += "\ndescription: %s" % func.__doc__
diff --git a/tests/test_builder/test_taskparams.py b/tests/test_builder/test_taskparams.py
index 56ee6b2..91f32d4 100644
--- a/tests/test_builder/test_taskparams.py
+++ b/tests/test_builder/test_taskparams.py
@@ -55,7 +55,7 @@ class TestParseTaskParams(unittest.TestCase):
                 spec.args.pop(0)
                 spec = spec[:-3]
             else:
-                spec = inspect.getargspec(h_class.handler)
+                spec = inspect.getfullargspec(h_class.handler)
                 # unbound method, so strip "self"
                 spec.args.pop(0)
 
diff --git a/www/kojiweb/wsgi_publisher.py b/www/kojiweb/wsgi_publisher.py
index 4d46a6b..5dfc235 100644
--- a/www/kojiweb/wsgi_publisher.py
+++ b/www/kojiweb/wsgi_publisher.py
@@ -216,7 +216,7 @@ class Dispatcher(object):
                 if not inspect.isfunction(val):
                     continue
                 # err on the side of paranoia
-                args = inspect.getargspec(val)
+                args = inspect.getfullargspec(val)
                 if not args[0] or args[0][0] != 'environ':
                     continue
             except Exception:
@@ -257,7 +257,7 @@ class Dispatcher(object):
             if isinstance(val, list) and len(val) == 1:
                 data[arg] = val[0]
         environ['koji.form'] = fs
-        args, varargs, varkw, defaults = inspect.getargspec(func)
+        args, varargs, varkw, defaults, _kwonlyargs, _kwonlydefaults, _annotations = inspect.getfullargspec(func)
         if not varkw:
             # remove any unexpected args
             data = dslice(data, args, strict=False)
-- 
2.37.3

